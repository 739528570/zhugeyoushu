<!--pages/bookdetail/index.wxml-->

<view class="reader-container">
  <!-- 顶部导航栏 -->
  <van-nav-bar title="{{book.title}}" left-text="返回" left-arrow bind:click-left="onBack" custom-class="reader-navbar" />

  <!-- 阅读区域 -->
  <view class="reader-content" id="readerContent">
    <!-- 翻页动画容器 -->
    <view class="page-container {{isAnimating ? 'animating' : ''}}">
      <!-- 当前页 -->
      <view class="page current-page" style="{{pageStyle}}">
        <text class="page-text" selectable user-select>{{currentPageText}}</text>
      </view>

      <!-- 下一页（预加载） -->
      <view class="page next-page" style="{{pageStyle}}" wx:if="{{nextPageText}}">
        <text class="page-text" selectable user-select>{{nextPageText}}</text>
      </view>
    </view>

    <!-- 进度指示器 -->
    <view class="progress-indicator">
      <text class="progress-text">{{currentPage}}/{{totalPages}}</text>
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{(currentPage/totalPages)*100}}%"></view>
      </view>
    </view>
  </view>

  <!-- 设置面板 -->
  <view class="settings-panel {{showSettings ? 'show' : ''}}">
    <view class="settings-header">
      <text>阅读设置</text>
      <van-icon name="cross" bind:tap="toggleSettings" />
    </view>

    <view class="settings-content">
      <view class="setting-item">
        <text>字体大小</text>
        <slider value="{{fontSize}}" min="14" max="30" step="1" bind:change="onFontSizeChange" />
        <text class="value">{{fontSize}}px</text>
      </view>

      <view class="setting-item">
        <text>行间距</text>
        <slider value="{{lineHeight}}" min="1.2" max="2.5" step="0.1" bind:change="onLineHeightChange" />
        <text class="value">{{lineHeight}}倍</text>
      </view>

      <view class="setting-item">
        <text>页边距</text>
        <slider value="{{pagePadding}}" min="10" max="40" step="2" bind:change="onPaddingChange" />
        <text class="value">{{pagePadding}}px</text>
      </view>

      <view class="setting-item">
        <text>字体</text>
        <picker range="{{fontFamilies}}" value="{{fontIndex}}" bind:change="onFontChange">
          <view class="picker">{{fontFamilies[fontIndex]}}</view>
        </picker>
      </view>
    </view>
  </view>

  <!-- 操作栏 -->
  <view class="action-bar">
    <van-icon name="setting-o" bind:tap="toggleSettings" />
    <van-icon name="bookmark-o" bind:tap="addBookmark" />
    <van-icon name="bars" bind:tap="showChapterList" />
  </view>

  <!-- 隐藏的Canvas用于测量 -->
  <canvas id="measureCanvas" type="2d" style="position: absolute; left: -9999px; width: {{canvasWidth}}px; height: {{canvasHeight}}px;"></canvas>
</view>